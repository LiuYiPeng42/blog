# AI Meets Database: AI4DB and DB4AI

## Overview of DB4AI and AI4DB

<img src="./AI Meets Database：AI4DB and DB4AI/1.png" alt="1" style="zoom:60%;" />

## AI for DB

### Learning-based Database Configuration

​		使用AI来自动化数据库的配置

#### Knob tuning

1. Knob tuning: 对数据库参数的调参（e.g., Work_Mem, Max_Connections）
2. 数据库管理员需要基于自己的经验，花费大量的时间来调参
3. CDBTune: 
   - 将数据库调参视为序列决策问题
   - 利用增强学习去提升调参的性能

4. QTune：
   - 使用深度学习来描述查询特征
   - 可以实现更细粒度的调参 （e.g., query-level tuning, session-level tuning, and system-level tuning.）

#### Index advisor

1. 在合适的属性列上使用索引可以实现很高的性能
2. 在大量的数据上建立索引的需要花费很多
3. Sadri等人提出了基于强化学习的索引选择方法
   - 没有使用专家规则
   - 将负载特征作为查询的到达率，字段的相关特征作为访问频率和字段的选择性
   - 使用马尔科夫决策过程（强化学习）从查询和字段的特征中学习，输出创建或丢弃的动作的集合

#### View advisor

1. 合适的使用视图可以很好的提升查询的性能，视图是利用空间换时间
2. 选择合适的物化视图可以有效的提升查询新能
   - 视图：视图可以用一张表或多张表（基表）来定义，是虚拟表，只有在查询此视图时才会执行视图创建时的语句
   - 物化视图：与普通视图不同，在创建时就将视图种的数据存储起来，在查询视图时不在执行创建语句
3. 现有的建立视图的方法是数据库管理员手动的去创建，但面对大型数据库和云数据库，数据库管理员就很难去手动创建
4. View advisor 可以为不同的查询负载选则合适的视图
5. Han等人提出了一种深度强化学习的方法估计不同物化视图和查询之间的效益，并且动态的为查询负载选择物化视图

#### SQL rewriter

1. SQL rewriter 可以去掉查询语句中多余和低效率的操作符
2. 对于一个较慢的查询，有很多不同的重写规则（因为有不同的操作符和适用的规则等）
3. 传统的经验的查询重写方法只能使用几个固定的重写规则（如自上而下），而且重写的结果可能不是最优的
4. 深度强化学习可以很好的选择合适的规则并以较好的顺序应用这些规则

#### Database Partition

1. Database Partition：将数据库的表和索引划分成更小的几部分
2. 传统的方法会启发式的选择一些字段作为分区键，并不能平衡负载与访问效率
3. 可以利用强化学习模型来尝试不同的分区键，通过实现一个全连接的神经网络来估计分区效益。

### Learning-based Database Optimization

​		旨在使用机器学习技术去解决数据库优化的难题

#### Cardinality/Cost estimation

1. 数据库优化依赖于基数估计和损失估计去选择则最优化的方式
2. 传统的技术无法有效的不活不同字段或表之间的联系，所以不能提供高质量的估计
3. 最近提出的基于深度学习的技术可以有效的获取到数据之间关系

#### Join order selection

1. Join order selection：在多表查询时，以不同的顺序连接表会有不同的执行效率，要从中选择出最佳的顺序
2. 一个SQL查询可能会有很多执行的方式，找到一个最佳的计划是很重要的
3. 传统的启发式的方法不能找到最合适的方式，并且动态的编程很难在较大的计划空间中找到合适的计划
4. 有很多基于深度强化学习的方法可以很好的自动挑选最好的执行计划

#### End-to-end optimizer

1. 传统的模型不仅依赖于 Cost estimation 和 Join order，还需要索引和视图，每一个步骤的好坏都会影响下一步骤的结果，所以就需要端到端的模型（没有中间的步骤，就只有输入和最终的结果）
2. Marcus 等人提出的端到端优化器 NEO 使用了PostgreSQL的查询执行计划及计划的延迟去预训练模型，此模型可以直接生成一个具体的计划

### Learning-based Database Design

​		传统的数据库只能根据经验来构建，最近出现了一些基于学习的自我设计的技术

#### Learned indexes

1. 索引可以看作是一个将主键映射为目标数据的位置的模型
2. Learned indexes经常被用于数据更新和高维数据

#### Learned data structure design

1. 不同的数据结构适合于不同的环境，
1. data structure alchemy 可以很好的自动推荐和设计数据结构

#### Learning-based transaction management

1. 有效的工作负载调度通过避免数据冲突，可以很大的提升性能
2. Learning-based transaction management分为两个方面，事务预测和事务调度
3. 基于规则的方法使用数据库引擎的领域知识（如内部延迟、资源利用率）来识别与工作负载特征相关的信号，当工作负载发生变化时，重建统计模型需要花费大量时间。所以，Ma等人[49]提出了一种基于ML的系统，可预测不同工作负载的未来趋势。
4. 传统数据库系统要么按顺序调度工作负载，无法考虑潜在冲突；要么根据数据库优化器预测的执行成本调度工作负载，Sheng等人提出了一种基于学习的事务调度方法，利用监督算法平衡并发率和冲突率。

### Learning-based Database Monitoring

#### Database Health Monitor

1. 在 Diagnosing root causes of intermittent slow queries in large-scale cloud databases 中假设不连续的执行较慢的查询都有相似的指标（CPU使用率、每秒的事务数量等）
1. 首先利用KPI特征对已经收集到的执行较慢的查询进行分类，然后由DBAs判断这些类别执行较慢的原因
1. 之后每查找到一个较慢的查询就根据此查询的KPI特征将此查询放到对应的类别中
1. 如果新的查询没有对应的分类，就创建一个新的类别，并由DBAs判断原因

#### Database Activity Monitor

1. DAM 大致分为两类：活动选择和活动跟踪。
2. 对于活动选择，传统的 DAM 方法需要根据触发规则记录额外系统上的所有活动。然而，记录所有活动仍然是一个沉重的负担，会带来数据库和监控系统之间频繁的数据交换。因此，需要自动选择和记录风险活动。
3. Hagit 等人[19] 将数据库监控视为多臂老虎机问题（MAB），通过利用当前策略和探索新策略来选择有风险的数据库活动。其目标是训练出风险分数最大的最优策略。

#### Performance Prediction

1. Marcus 等人使用深度学习预测并发场景下的查询延迟，包括子操作符/父操作符之间的交互和并行计划。
2. Zhou 等人提出了一种采用图嵌入的性能预测方法。他们使用图模型来描述并发查询，并利用图卷积网络将工作负载图嵌入到性能指标中

#### Learning-based Database Security

#### Learning-based Sensitive Data Discovery

1. 敏感数据发现旨在自动检测和保护机密数据。
2.  Fernandez等人提出了一个数据发现系统，可以根据用户的需求提供灵活的查询去查询数据集

#### Access Control

1. 传统的方法很难有效的阻止没有权限的用户访问数据，基于机器学习的算法可以有效地估计访问请求的合法性
2.  Colombo等人提出了基于目的的访问控制模型，可以通过定制控制规则去规范数据请求，因为不同的行为和数据内容可能有不同的隐私问题，所以此方法旨在学习合法的访问目的

#### SQL Injection

​		可以通过分类树和模糊神经网络去检测sql注入

### Learning-based Database Systems



## DB for AI

### Declarative Language Model

1. SQL相对其他编程语言更容易使用，但是很难进行一些复杂的操作，比如模型的训练
2. 可以对SQL进行拓展以至于其可以支持AI模型

### Data Governance.

####  Data discovery

1. 数据发现：可以根据用户的需求，自动在数据库中找到相关的数据集
2. Fernandez等人提出了Aurum数据发现系统，此系统利用企业知识图谱（enterprise knowledge graph）来获取各种关系去支持大量的查询
3. 企业知识图谱是一个超图，其中每个节点表示一张表的字段，每条边表示两个节点之间的关系，超边连接具有层次关系的节点，如同一张表的字段（在同一个层次中）

#### Data cleaning

1. 脏数据或不一致数据会严重影响训练效果。
2. 数据清洗和整合技术可以检测和修复脏数据，并整合来自多个来源的数据。
3. Wang 等人提出了一种用于机器学习任务的清洗框架 ActiveClean。在给定一个数据集和具有凸损失的机器学习模型的情况下，它可以选择最能提高模型性能的记录，并对这些记录进行迭代清洗。

#### Data labeling

1. 可以利用领域专家、众包（企业通过互联网将工作分包给大众）和现有知识，为人工智能算法标注大量训练数据

### Model Training

#### Feature selection

1. 批处理、物化可以用户减少迭代的消耗
2. 主动学习可以加快评估过程

#### Model selection

1. 模型选择的目的是从大量可能的模型中选择合适的模型
2. 可以加快模型选择的技术有并行技术，包括任务并行、批量同步并行、参数服务器和模型并行

#### Model management

1. 由于模型训练是一个试错过程，需要维护许多已尝试过的模型和参数，因此有必要设计一个模型管理系统来跟踪、存储和搜索 ML 模型。
2. 有基于图形用户界面的和基于命令的模型 管理系统。

#### Hardware acceleration

​	可以使用GPU和FPGA加速模型的训练

### Model Inference

#### Operator support

1. 机器学习模型可以使用各种类型的运算符对数据和参数进行计算，如标量运算符和张量运算符
2. 可以直接在数据库系统内执行AI或机器学习的相关操作，而不是从数据库中提取数据、在外部处理数据，然后将结果存回数据库。通过在数据库内进行计算，可以利用数据库的并行处理能力和查询优化功能，从而提高性能。

#### Operator selection

1. 同一个算法模型可以使用不同的优化技术和物理运算符来实现。这些物理运算符可以是底层硬件或数据库引擎中的操作，如矩阵乘法、聚合函数等。不同的物理运算符可能对计算性能和资源消耗产生显著影响。
2. 通过在数据库中选择合适的物理运算符，可以根据数据库系统的资源情况和优化策略，估计运算符的资源消耗，并巧妙地安排这些运算符的执行顺序。

#### Execution acceleration

1. 模型推理的加速技术包括内存内方法和分布式方法
2. 放入内存方法的目标是尽量将数据保存在内存中，并在内存内进行计算
3. 分布式方法将任务分配给不同的计算节点，通过并行计算来加速模型推断

## Challenges and Open Problems

### AI4DB

#### Model Selection

1. 手动选择合适的模型和调整参数效率低
2. 较难判断一个模型是否在大多数情况下是有效的

#### Model Validation

​		很难评估学习到的模型是否有效，是否优于非学习方法

#### Model Management

​		不同的数据库组件可能会使用不同的 ML 模型，因此必须提供统一的 ML 平台，以实现统一的资源调度和统一的模型管理。

#### Training data

​		在AI4DB领域中，由于涉及安全性问题或依赖数据库管理员（DBA）的经验，获取大规模、高质量和多样化的训练数据可能较为困难

#### Adaptability

​		使模型适应不同的动态数据更新、其他的数据集，新的硬件环境和其他数据库系统是一个较大的挑战

#### Model convergence（收敛）

​		模型的首先是非常重要的

#### Learning for OLAP

​		传统的OLAP注重于关系数据的分析，而近年来出现了很多新的数据的类型，如图数据、时间序列数等

#### Learning for OLTP

​		OLTP系统的事务建模和调度很重要，但是这两者都会有一些性能的开销，所以需要更好的模型在多核和多机器的环境中来快速建模与调度

### DB4AI

#### In-database training

​		在数据库内部支持模型训练（包括模型存储、模型更新和并行训练）具有挑战性

#### Training acceleration using database techniques

​		大多数研究都关注人工智能算法的有效性，但对其效率并不十分重视。

#### AI optimizer

​		现有研究使用用户自定义函数（UDF）来支持人工智能模型，但这些函数并没有得到有效优化

####  Fault-tolerant learning

​		现有的学习模型训练没有考虑到容错

### AI&DB co-optimization

#### Hybrid relational and tensor model

​		CPU不擅长处理张量模型，而AI芯片不能有效处理关系模型，所以需要有效的方法来加速人工智能芯片上的关系操作，在传统 CPU 和AI芯片之间调度运算符，并同时支持关系模型和张量模型。

#### Hybrid DB&AI inference

​		许多应用程序需要同时进行数据库和AI操作，这就需要一个新的优化模型来优化 DB 和 AI

#### Hybrid DB&AI system

​		当下需要一种端到端混合人工智能和数据库系统支持声明式语言，如 AISQL，该语言扩展了 SQL，以支持人工智能运算符
